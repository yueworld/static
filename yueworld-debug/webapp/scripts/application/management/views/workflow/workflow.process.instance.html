<div class="col-xs-12 p0 ys-product-process-instance">
    <!--功能按钮区域-->
    <div class="col-xs-12 pt15 pr0 ys-product-process-instance-toolbar">
        <div class="pull-left">
            <button type="button" class="btn btn-primary" ng-click="$app.back()">返回</button>
            <!-- 任务未结束、并且审批人是当前登陆人-->
            <button type="button" class="btn btn-success" ng-click="api.service.temporary()"
                    ng-if="::api.instance.statusId==1001&&api.task.approvalUserId==$app.user.id">
                保存草稿
            </button>
            <!-- 只有状态在未发起前、并且是流程发起人 才有权利删除 -->
            <button type="button" class="btn btn-danger" ng-click="drop()"
                    ng-if="::api.instance.applyUserId==$app.user.id&&api.instance.statusId<=1003">
                删除
            </button>
            <!-- 只在发起后显示-->
            <button type="button" class="btn btn-danger" ng-if="::isRecover()" ng-if="false">
                追回
            </button>
            <!-- 只在未发起前显示-->
            <button type="button" class="btn btn-default" ng-click="api.service.attachment()"
                    ng-if="::api.instance.statusId<=1003&&api.task.approvalUserId==$app.user.id">
                附件
            </button>
            <!-- 查看流程-->
            <button type="button" class="btn btn-default" ng-click="api.service.diagram()">
                查看流程
            </button>
            <!-- 只在发起后显示 ng-if="::api.instance.statusId>1003" -->
            <button type="button" class="btn btn-default" ng-if="false">
                共享
            </button>
            <!-- 只在发起后显示-->
            <button type="button" class="btn btn-default" ng-click="api.service.print()"
                    ng-if="::api.instance.statusId>1003">
                打印
            </button>
        </div>
        <div class="pull-right">
            <button type="button" class="btn btn-default pull-left" style="width: initial" ng-class="button.style||'btn-danger'"
                    ng-click="button.click()"
                    ng-repeat="button in api.setting.toolbar">
                {{::button.text}}
            </button>
            <button type="button" class="btn btn-default pull-left mr0" ng-click="$parent.folding()">
                {{$parent.foldingStatus==1?"退出全屏":"全屏模式"}}
            </button>
        </div>
    </div>

    <div class="col-xs-12 pr0 pl20 pb20 pt10 ys-product-process-instance-wrapper">
        <!-- 字段信息提示区 -->
        <div class="col-xs-12 p0 pb20">
            <div class="pull-left pr10 text-info">
                <span class="text-invalid">当前位置：</span> {{::api.process.path}}
            </div>
            <div class="pull-left pr10 text-info">
                <span class="text-invalid">网批号：</span>{{::api.instance.displayNo}}
            </div>
            <div class="pull-left pr10 text-info">
                <span class="text-invalid">发起人：</span>{{::api.instance.applyUserRealname}}
            </div>
            <div class="pull-left pr10 text-info" ng-if="::api.instance.statusId>1003">
                <span class="text-invalid">发起日期：</span> {{::api.instance.startDate|date:'yyyy-MM-dd HH:mm'}}
            </div>
            <div class="pull-left pr10 text-blue">
                <span class="text-invalid">状态：</span>
                {{::$app.dictionary.WORKFLOW_APPROVAL_STATUS.hash[api.instance.statusId].text}}
            </div>
        </div>
        <!-- 主题 -->
        <div class="col-xs-12 p0 pb20 text-center ys-product-process-instance-subject">{{::api.process.name}}</div>
        <!-- 注意事项 -->
        <div class="col-xs-12 p0 pb20 mb20 ys-product-process-instance-tips" ng-if="false">
            <div class="text-center pull-left">
                <icon name="gth-1" height="40px" width="40px" class="text-danger"></icon>
            </div>
            <div class="col-xs-11 p0">
                <ul>
                    <li>短期请假，指请假天数在3天及以内的请假；</li>
                    <li>长期请假，指请假天数3天以上或公休假前后请假，公休假指：元旦、春节、清明节、劳动节、端午节、中秋节、国庆节；</li>
                    <li>请假类别为“全薪病假”、“超额病假”、“事假”、“产检”的请假单位为小时。</li>
                    <li>网批完成后，请推送给总经办人事负责人</li>
                </ul>
            </div>
        </div>

        <!-- 模版加载失败、错误提示--> 
        <div class="col-xs-12 p0 mb20 ys-product-process-instance-script-error" ng-if="::api.form.error"
             ng-bind="::api.form.error"></div>

        <!-- 模版填充区域 -->
        <div class="col-xs-12 p0 mb20 ys-product-process-instance-template animated-ui-view fadeIn fadeOut"></div>

        <!-- 附件 -->
        <div class="col-xs-12 p0 mb20 ys-form-grid ys-product-process-instance-attachment"
             ng-if="api.instance.attachments.length">
            <div class="col-xs-12 p0 bt6"></div>
            <table class="table table-bordered col-xs-12 mb0" ng-class="{'up':xgfj}">
                <colgroup>
                    <col width="60%">
                    <col width="20%">
                    <col width="20%">
                </colgroup>
                <tr>
                    <th colspan="4" class="title">
                        <strong>相关附件</strong>
                        <div class="pointer pull-right pr5" ng-click="xgfj=!xgfj">
                            <icon name="down-1" height="40px" width="30px"></icon>
                        </div>
                    </th>
                </tr>
                <tr ng-repeat="file in api.instance.attachments">
                    <td class="pl20">
                        <a ng-href="{{$app.getStaticUrl(file.path)}}" target="_blank" ng-bind="file.originalName"></a>
                        <a href="javascript:void(0)" class="text-danger"
                           ng-if="file.creator==$app.user.id&&api.task.isComplete==2"
                           ng-click="api.service.dropAttachment(file)">删除</a>
                    </td>
                    <td class="spr" ng-bind="file.realname"></td>
                    <td ng-bind="file.createdDate|date:'yyyy-MM-dd HH:mm'"></td>
                </tr>
                <tr ng-if="!api.instance.attachments.length">
                    <td colspan="3" class="no-data" style="height: 60px;line-height: 60px">
                        未上传附件
                    </td>
                </tr>
            </table>
        </div>

        <!-- 审批流程 -->
        <!--ng-init="splct=api.instance.statusId>1003"-->
        <div class="col-xs-12 p0 mb20 ys-product-process-instance-diagram" ng-class="{'up':!splct}"
             ng-init="splct=true">
            <div class="col-xs-12 pr10 title">
                <div class="col-xs-6 mt15 pl15 text">
                    审批流程
                </div>
                <div class="pointer pull-right" ng-click="splct=!splct">
                    <icon name="down-1" height="46px" width="30px"></icon>
                </div>
            </div>
            <div class="col-xs-12 p20 body" ng-if="splct">
                <img ng-src="{{diagramUrl}}" wf-map-area nodes="api.instance.nodes"/>
            </div>
        </div>

        <!-- 审批记录 -->
        <div class="col-xs-12 p0 mb20 ys-product-process-instance-jumps" ng-class="{'up':spjl}"
             ng-if="api.instance.jumps.length">
            <div class="col-xs-12 pr10 title">
                <div class="col-xs-6 mt15 pl15"
                     style="height: 16px;line-height:16px;border-left: 3px solid #e94d4e;">
                    审批记录
                </div>
                <div class="pointer pull-right" ng-click="spjl=!spjl">
                    <icon name="down-1" height="46px" width="30px"></icon>
                </div>
            </div>
            <table class="table" ng-if="!spjl">
                <colgroup>
                    <col width="22%"/>
                    <col/>
                    <col/>
                    <col/>
                    <col/>
                    <col/>
                </colgroup>
                <tr>
                    <th>处理时间</th>
                    <th>用时</th>
                    <th>节点名称</th>
                    <th>操作人</th>
                    <th>操作</th>
                    <th>处理意见</th>
                </tr>
                <tr ng-repeat="item in api.instance.jumps">
                    <td style="vertical-align: middle">{{::item.completeDate|date:'yyyy-MM-dd HH:mm'}}</td>
                    <td style="vertical-align: middle">{{::$app.date.millisecondToCn(item.duration)}}</td>
                    <td style="vertical-align: middle">{{::item.nodeName||'-'}}</td>
                    <td class="text-ellipsis" style="vertical-align: middle">
                            <span ng-if="::item.handlerId==item.ownerId">
                                {{::item.handlerRealname}} / {{::item.handlerPosName}}
                            </span>
                        <span ng-if="::item.handlerId!=item.ownerId">
                                <span ng-if="::item.statusId==9999">
                                    {{item.ownerRealname}} / {{::item.ownerPosName}}
                                </span>
                                <span ng-if="::item.statusId!=9999">
                                    {{::item.handlerRealname}} / {{::item.handlerPosName}}<br/>
                                    <span class="text-danger">
                                        原审批人：{{::item.ownerRealname}} / {{::item.ownerPosName}}
                                    </span>
                                </span>
                            </span>
                    </td>
                    <td style="vertical-align: middle">
                        {{::$app.dictionary.WORKFLOW_JUMP_TYPE.hash[item.statusId].text}}
                    </td>
                    <td style="vertical-align: middle">{{::item.opinion||'-'}}</td>
                </tr>
            </table>
        </div>

        <!-- 流转过程处理区域 -->
        <div class="col-xs-12 p0" ng-if="api.instance.statusId>1003">
            <!-- 留言记录 -->
            <div class="col-xs-12 p0 mb20 ys-product-process-instance-comment" ng-class="{'up':lyjl}"
                 ng-if="api.instance.comments.length">
                <div class="col-xs-12 pr10 title">
                    <div class="col-xs-6 mt15 pl15 text">
                        留言记录
                    </div>
                    <div class="pointer pull-right" ng-click="wdclyj=!wdclyj">
                        <icon name="down-1" height="46px" width="30px"></icon>
                    </div>
                </div>
                <table class="table" ng-if="!wdclyj">
                    <colgroup>
                        <col width="22%"/>
                        <col/>
                    </colgroup>
                    <tr>
                        <th style="padding-left: 34px">人员</th>
                        <th>留言内容</th>
                    </tr>
                    <tr ng-repeat="comment in api.instance.comments">
                        <td style="vertical-align: middle;">{{comment.realname}}</td>
                        <td style="padding:10px 15px!important;">
                            <div class="text-invalid">{{comment.createdDate|date:'yyyy-MM-dd HH:mm'}}</div>
                            <div>{{comment.content}}</div>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- 审批意见 -->
            <div class="col-xs-12 p0  ys-product-process-instance-approve" ng-class="{'up':wdclyj}"
                 ng-if="::api.task.isComplete==2&&$app.user.id==api.task.approvalUserId">
                <div class="col-xs-12 pr10 title">
                    <div class="col-xs-6 mt15 pl15 text">
                        审批意见
                    </div>
                    <div class="pointer pull-right" ng-click="wdclyj=!wdclyj">
                        <icon name="down-1" height="46px" width="30px"></icon>
                    </div>
                </div>
                <table class="table" ng-if="!wdclyj">
                    <colgroup>
                        <col width="22%"/>
                        <col/>
                    </colgroup>
                    <tr>
                        <td>操作</td>
                        <td style="padding:0px!important;">
                            <div class="pl15" error="{{command.errorCode}}" code="9001">
                            <span class="pr10 pointer" ng-click="command.jumpTypeId=1001">
                                <span class="ys-radio"
                                      ng-class="{'selected':command.jumpTypeId==1001}"></span>
                                通过
                            </span>
                                <span class="pr10 pointer" ng-click="command.jumpTypeId=1008">
                                <span class="ys-radio"
                                      ng-class="{'selected':command.jumpTypeId==1008}"></span>
                                驳回 (上个节点)
                            </span>
                                <span class="pr10 pointer" ng-click="command.jumpTypeId=1009">
                                <span class="ys-radio"
                                      ng-class="{'selected':command.jumpTypeId==1009}"></span>
                                驳回 (发起人)
                            </span>
                                <!--<span class="pr10 pointer" ng-click="command.jumpTypeId=1005">
                                    <span class="ys-radio"
                                          ng-class="{'selected':command.jumpTypeId==1005}"></span>
                                    沟通（留言）
                                </span>-->
                            </div>
                        </td>
                    </tr>
                    <tr ng-if="command.jumpTypeId==1001&&api.task.next.length">
                        <td style="vertical-align: middle">即将流向</td>
                        <td style="padding:15px 15px!important">
                            <div class="col-xs-12 p0 ry" ng-repeat="next in api.task.next"
                                 ng-init="node=api.instance.nfaNodes[next.id]">
                                <span class="node" ng-if="!node.multiInstance">{{node.name}}</span>
                                <span class="node" ng-if="node.multiInstance">{{node.name}} (会签)</span>
                                <div ng-if="node.identityTypeId==1001||(node.identityTypeId==1002&&node.pos.length==1)"
                                     style="height: 38px;line-height: 38px;"> <!-- 发起人/固定单审批人 -->
                                    <span class="ml15"> {{node.approvalUserRealname}}</span>
                                </div>
                                <!-- 固定多审批人 -->
                                <div style="width: 286px; float: left;padding-left: 15px;"
                                     ng-if="node.identityTypeId==1002&&node.pos.length>1">
                                    <select class="require" select2="node.select2Options"
                                            ng-model="node.approvalUserId" error="{{command.errorCode}}" code="9002"
                                            expression="!node.approvalUserId" ng-model="node.approvalUserId"></select>
                                </div>
                                <!-- 自定义审批人 -->
                                <div style="width: 300px; float: left;padding-left: 15px;"
                                     ng-if="node.identityTypeId==1003">
                                    <input type="text" class="form-control require"
                                           style="margin-top: 7px; margin-bottom:7px; "
                                           value="{{node.approvalUserRealname}}"
                                           ng-click="setApprovalUser(node)"
                                           error="{{command.errorCode}}" code="9002"
                                           expression="!api.instance.nfaNodes[id].approvalUserId"
                                           placeholder="{{node.placeholder}}" readonly>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr><!--ng-if="command.jumpTypeId>=1001&&command.jumpTypeId<=1004"-->
                        <td style="vertical-align: middle">
                            处理意见
                        </td>
                        <td style="padding:15px!important">
                            <div class="col-xs-12 p0 pb15">
                                <div style="width: 460px"><select select2="aros" ng-model="aros.reason"></select></div>
                            </div>
                            <div class="col-xs-12 p0">
                                <textarea class="form-control" ng-model="command.opinion"
                                          placeholder="请输入您的处理意见" error="{{command.errorCode}}"
                                          code="9003"></textarea>
                            </div>
                        </td>
                    </tr>
                    <!--ng-if="command.jumpTypeId>=1002&&command.jumpTypeId<=1004"-->
                    <tr ng-if="command.jumpTypeId==1001">
                        <td>附件</td>
                        <td class="pl15 text-primary">
                            <span class="pointer" uploader="aus">上传附件</span>
                        </td>
                    </tr>
                    <!-- ng-if="command.jumpTypeId>=1002&&command.jumpTypeId<=1004"-->
                    <tr>
                        <td></td>
                        <td>
                            <div class="col-xs-12 p0 pt10 pb10">
                                <button class="btn btn-danger" style="padding-left:20px;padding-right:20px;"
                                        ng-click="submit()">
                                    提交审批
                                </button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

        </div>

        <!-- 填写审批人 -->
        <div class="col-xs-12 p0"
             ng-if="::(api.instance.statusId=='1001'||api.instance.statusId=='1002')&&api.task.approvalUserId==$app.user.id">
            <!-- 填写审批人 -->
            <button class="btn btn-danger" ng-click="setInstanceStatusToFillApprovalUser()">
                保存并填写审批人
            </button>
        </div>

        <!-- 填写审批人 -->
        <div class="col-xs-12 p0 ys-product-process-instance-edit-start"
             ng-if="::api.instance.statusId=='1003'&&$app.user.id==api.task.approvalUserId">
            <div class="col-xs-12 p0 toolbar">
                <!-- 返回继续编辑 -->
                <button class="btn btn-default pull-left" ng-click="setInstanceStatusToInit()">继续编辑</button>
                <!-- 发起 -->
                <button class="btn btn-danger pull-left" ng-click="submit()">发起
                    <!--{{api.instance.nfaNodes}}--> </button>
            </div>

            <div class="col-xs-12 p0">
                <hr/>
            </div>

            <!-- 待填审批人信息 -->
            <div class="col-xs-12 p0 form-horizontal ys-form ys-product-process-instance-approve-user">
                <div class="col-xs-12 p0 pl20 mb15" ng-repeat="(id,node) in api.instance.nfaNodes">
                    <div class="col-xs-3 text-right lh38">{{($index+1)+" . "+node.name}}<span
                            ng-if="::node.multiInstance" class="text-danger">  - (会签)</span></div>
                    <div class="col-xs-6 p0">
                        <input type="text" class="form-control require" value="{{node.approvalUserRealname}}"
                               ng-click="setApprovalUser(node)" error="{{command.errorCode}}" code="9002"
                               expression="!node.approvalUserId||(node.multiInstance&&node.approvalUserId.split(',').length<2)"
                               placeholder="{{node.placeholder}}" readonly
                               ng-if="::node.identityTypeId!=1002" ng-class="{'readonly':node.identityTypeId=='1001'}">
                        <select class="require" select2="node.select2Options" ng-model="node.approvalUserId"
                                error="{{command.errorCode}}" code="9002"
                                expression="!node.approvalUserId||(node.multiInstance&&node.approvalUserId.length<2)"
                                ng-if="::node.identityTypeId==1002"></select>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>